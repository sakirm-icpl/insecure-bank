pipeline {
    agent any

    stages {
        stage('Clone Repository') {
            steps {
                // Clone your repository
                checkout scm
            }
        }

        stage('Install Akto CLI') {
            steps {
                // Specify the release version in the URL
                sh 'wget https://github.com/indranilokg/atko-cli/archive/refs/tags/0.0.3.tar.gz'
                sh 'tar -zxvf 0.0.3.tar.gz'
                sh 'sudo mv akto-cli-0.0.3 /usr/bin'
            }
        }

        stage('Set Akto API Key') {
            steps {
                environmentVariables {
                    env AKTO_API_KEY='D4k5Yu2yOQZ3CAb24OS4aOSH5H2xSVQTv0TmZ21I'
                }
            }
        }

        stage('Run API tests') {
            steps {
                sh 'akto test'
            }
        }
    }
}
